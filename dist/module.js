/*! For license information please see module.js.LICENSE.txt */
define(["react","emotion","@grafana/ui","@grafana/data","lodash"],(function(e,t,a,r,l){return function(e){var t={};function a(r){if(t[r])return t[r].exports;var l=t[r]={i:r,l:!1,exports:{}};return e[r].call(l.exports,l,l.exports,a),l.l=!0,l.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)a.d(r,l,function(t){return e[t]}.bind(null,l));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/",a(a.s=6)}([function(t,a){t.exports=e},function(e,a){e.exports=t},function(e,t){e.exports=a},function(e,t){e.exports=r},function(e,t){e.exports=l},function(e,t,a){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var l in t=arguments[a])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)},l=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.hasOwnProperty.call(e,a)&&l(t,e,a);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=i(a(0)),s=a(0),c=function(e){var t=e.cardStyles,a=t.back,l=t.front,n=e.cardZIndex,i=e.containerStyle,c=e.containerClassName,u=e.flipDirection,d=e.flipSpeedFrontToBack,p=e.flipSpeedBackToFront,f=e.infinite,h=s.useState(e.isFlipped),m=h[0],v=h[1],b=s.useState(0),g=b[0],y=b[1];s.useEffect((function(){e.isFlipped!==m&&(v(e.isFlipped),y((function(e){return e+180})))}),[e.isFlipped]);var O=s.useMemo((function(){var e="react-card-flip";return c&&(e+=" "+c),e}),[c]),w=function(t){if(2!==e.children.length)throw new Error("Component ReactCardFlip requires 2 children to function");return e.children[t]},x="rotateY("+(f?g:m?180:0)+"deg)",T="rotateX("+(f?g:m?180:0)+"deg)",S={back:r({WebkitBackfaceVisibility:"hidden",backfaceVisibility:"hidden",height:"100%",left:"0",position:m?"relative":"absolute",top:"0",transform:"horizontal"===u?"rotateY("+(f?g+180:m?0:-180)+"deg)":"rotateX("+(f?g+180:m?0:-180)+"deg)",transformStyle:"preserve-3d",transition:d+"s",width:"100%"},a),container:{perspective:"1000px",zIndex:""+n},flipper:{height:"100%",position:"relative",width:"100%"},front:r({WebkitBackfaceVisibility:"hidden",backfaceVisibility:"hidden",height:"100%",left:"0",position:m?"absolute":"relative",top:"0",transform:"horizontal"===u?x:T,transformStyle:"preserve-3d",transition:p+"s",width:"100%",zIndex:"2"},l)};return o.createElement("div",{className:O,style:r(r({},S.container),i)},o.createElement("div",{className:"react-card-flipper",style:S.flipper},o.createElement("div",{className:"react-card-front",style:S.front},w(0)),o.createElement("div",{className:"react-card-back",style:S.back},w(1))))};c.defaultProps={cardStyles:{back:{},front:{}},cardZIndex:"auto",containerStyle:{},flipDirection:"horizontal",flipSpeedBackToFront:.6,flipSpeedFrontToBack:.6,infinite:!1,isFlipped:!1},t.default=c},function(e,t,a){"use strict";a.r(t);var r=a(3);var l=function(){return(l=Object.assign||function(e){for(var t,a=1,r=arguments.length;a<r;a++)for(var l in t=arguments[a])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)};function n(e,t){var a="function"==typeof Symbol&&e[Symbol.iterator];if(!a)return e;var r,l,n=a.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=n.next()).done;)i.push(r.value)}catch(e){l={error:e}}finally{try{r&&!r.done&&(a=n.return)&&a.call(n)}finally{if(l)throw l.error}}return i}var i=a(2),o=a(1),s=a(0),c=a.n(s),u=a(5),d=a.n(u);var p=function(e,t,a,r){var l=Object(s.useRef)(t);Object(s.useLayoutEffect)((function(){l.current=t}),[t]),Object(s.useEffect)((function(){var t,n=(null===(t=a)||void 0===t?void 0:t.current)||window;if(n&&n.addEventListener){var i=function(e){return l.current(e)};return n.addEventListener(e,i,r),function(){n.removeEventListener(e,i)}}}),[e,a,r])};var f=function(e){var t=n(Object(s.useState)(!1),2),a=t[0],r=t[1];return p("mouseenter",(function(){return r(!0)}),e),p("mouseleave",(function(){return r(!1)}),e),a};var h=function(e,t){var a=Object(s.useRef)(e);Object(s.useLayoutEffect)((function(){a.current=e}),[e]),Object(s.useEffect)((function(){if(t||0===t){var e=setInterval((function(){return a.current()}),t);return function(){return clearInterval(e)}}}),[t])},m=function(e){var t=e.autoScroll,a=e.hover,r=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(r=Object.getOwnPropertySymbols(e);l<r.length;l++)t.indexOf(r[l])<0&&Object.prototype.propertyIsEnumerable.call(e,r[l])&&(a[r[l]]=e[r[l]])}return a}(e,["autoScroll","hover"]),i=c.a.useRef(null),o=n(c.a.useState(0),2),s=o[0],u=o[1],d=n(c.a.useState(1),2),p=d[0],f=d[1];return h((function(){i.current&&(a?u(0|i.current.parentElement.scrollTop):t&&(0<=s&&s<=i.current.parentElement.scrollHeight-i.current.parentElement.offsetHeight+1?(i.current.parentElement.scrollTo(0,s),u(s+p)):(u(s-p),f(-p))))}),1e3/30),c.a.createElement("div",l({ref:i},r))},v=a(4),b=a.n(v);var g=function(e){return e.href?c.a.createElement("a",l({},e)):c.a.createElement(c.a.Fragment,null,e.children)},y=function(e){var t=e.value,a=e.onChange,n=r.standardEditorsRegistry.get("color").editor,o=Object(i.getTheme)(),s=function(e){return function(n){var i;return a(l(l({},t),((i={})[e]=Object(r.getColorForTheme)(n,o),i)))}};return c.a.createElement(i.HorizontalGroup,{spacing:"lg"},c.a.createElement("div",null,c.a.createElement(i.Label,null,"Critical"),n({value:t.crit,onChange:s("crit")})),c.a.createElement("div",null,c.a.createElement(i.Label,null,"Warning"),n({value:t.warn,onChange:s("warn")})),c.a.createElement("div",null,c.a.createElement(i.Label,null,"OK"),n({value:t.ok,onChange:s("ok")})),c.a.createElement("div",null,c.a.createElement(i.Label,null,"Disabled"),n({value:t.disable,onChange:s("disable")})))},O=[{label:"Number Threshold",value:"Number Threshold",description:"Change background color of the panel if got warning / error + show the alias of the problematic metrics."},{label:"String Threshold",value:"String Threshold",description:"Change background color of the panel if got warning / error + show the alias of the problematic metrics."},{label:"Date Threshold",value:"Date Threshold",description:"Change background color of the panel if got warning / error + show the alias of the problematic metrics."},{label:"Disable Criteria",value:"Disable Criteria",description:"Change background color of the panel to grey if disabled."},{label:"Text Only",value:"Text Only",description:"Show the alias + the value on the panel without any condition."}],w=function(e){var t,a=e.value,r=e.onChange;return a||(a={valueHandler:"Number Threshold",crit:"90",warn:"70"}),"Number Threshold"===a.valueHandler?t="number":"String Threshold"===a.valueHandler?t="text":"Date Threshold"===a.valueHandler&&(t="datetime-local"),c.a.createElement(c.a.Fragment,null,c.a.createElement(i.Select,{value:a.valueHandler,options:O,onChange:function(e){var t=e.value;return t&&r(l(l({},a),{valueHandler:t}))}}),t&&c.a.createElement(c.a.Fragment,null,c.a.createElement(i.Label,null,"Critical Value"),c.a.createElement(i.Input,{value:a.crit,type:t,onChange:function(e){var t=e.currentTarget.value;return r(l(l({},a),{crit:t}))}}),c.a.createElement(i.Label,null,"Warning Value"),c.a.createElement(i.Input,{value:a.warn,type:t,onChange:function(e){var t=e.currentTarget.value;return r(l(l({},a),{warn:t}))}})))};a.d(t,"plugin",(function(){return x}));var x=new r.PanelPlugin((function(e){var t=e.data,a=e.options,s=e.fieldConfig,u=e.width,p=e.height,v=e.replaceVariables,y=e.timeZone,O={ok:a.isIgnoreOKColors?"":Object(o.css)({color:a.colors.ok}),warn:Object(o.css)({color:a.colors.warn}),crit:Object(o.css)({color:a.colors.crit}),disable:Object(o.css)({color:a.colors.disable}),noData:Object(o.css)({color:a.colors.disable}),hide:Object(o.css)({display:"none"})},w=function(e,t,a,n,i,s){var c=[],u=[],d=[],p=[],f=[];return e.series.forEach((function(e){var h,m,v=e.fields.find((function(e){return"Time"!==e.name}));if(null===(h=v)||void 0===h?void 0:h.state){var g=b.a.defaultsDeep(l({},v.config),t.defaults);if(g.custom){console.log(g);var y="Always"===g.custom.displayAliasType?"ok":"hide",O="";switch(g.custom.thresholds.valueHandler){case"Number Threshold":var w=v.state.calcs[g.custom.aggregation],x=+g.custom.thresholds.crit,T=+g.custom.thresholds.warn;T<=x&&x<=w||T>=x&&x>=w?y="crit":(T<=w&&w<=x||T>=w&&w>=x)&&(y="warn"),O=b.a.isFinite(w)?g.unit?Object(r.formattedValueToString)(Object(r.toFixedUnit)(g.unit)(w,g.decimals)):Object(r.toFixed)(w,g.decimals):"Invalid Number";break;case"String Threshold":null!=(O=v.state.calcs[g.custom.aggregation])&&O==O||(O="Invalid String"),O===g.custom.thresholds.crit?y="crit":O===g.custom.thresholds.warn&&(y="warn");break;case"Date Threshold":var S=v.state.calcs[g.custom.aggregation],C=Object(r.dateTimeAsMoment)(S);"utc"===s&&(C=C.utc()),O=C.format(g.custom.dateFormat),S===g.custom.thresholds.crit?y="crit":S===g.custom.thresholds.warn&&(y="warn");break;case"Disable Criteria":v.state.calcs[g.custom.aggregation]===g.custom.disabledValue&&(y="disable")}var E=g.custom.displayValueWithAlias,D="When Alias Displayed"===E||"warn"===y&&"Warning / Critical"===E||"crit"===y&&("Warning / Critical"===E||"Critical Only"===E);if(D&&g.custom.valueDisplayRegex)try{O=O.replace(new RegExp(g.custom.valueDisplayRegex),"")}catch(e){}var j=(m=v.getLinks&&v.getLinks({}),null!=m?m:[])[0];j&&(j.href=i(j.href));var N={alias:g.displayName||e.name||e.refId||"",displayValue:D?O:void 0,link:j};"ok"!==y&&("Bold"===g.custom.fontFormat?N.className=Object(o.css)({fontWeight:"bold"}):"Italic"===g.custom.fontFormat&&(N.className=Object(o.css)({fontStyle:"italic"}))),"Metric"===a.colorMode&&(N.className=Object(o.cx)(N.className,n[y])),"ok"===y?"Regular"===g.custom.displayType?u.push(N):c.push(N):"warn"===y?p.push(N):"crit"===y?d.push(N):"disable"===y&&f.push(N)}}})),{annotations:c,disables:f,crits:d,warns:p,displays:u}}(t,s,a,O,v,y),x=w.annotations,T=w.disables,S=w.crits,C=w.warns,E=w.displays;a.isHideAlertsOnDisable&&T.length>0&&(S=C=E=[]);var D=[T,S,C,E].flat(1),j=null;0<=a.maxAlertNumber&&a.maxAlertNumber<D.length&&(j=D.length-a.maxAlertNumber,D=D.slice(0,a.maxAlertNumber));var N=n(c.a.useState(!0),2),k=N[0],I=N[1],V=c.a.useRef(null),A=f(V);h((function(){return a.flipCard&&!A&&I(!k)}),1e3*a.flipTime);var P=T.length?"disable":S.length?"crit":C.length?"warn":!t.series.length&&a.isGrayOnNoData?"noData":"ok";return c.a.createElement("div",{ref:V,className:Object(o.css)({width:u,height:p,boxSizing:"border-box",borderRadius:a.cornerRadius,overflow:"hidden",zIndex:10},!("ok"===P&&a.isIgnoreOKColors)&&"Panel"===a.colorMode&&{backgroundColor:a.colors[P]})},c.a.createElement(d.a,{isFlipped:k},c.a.createElement("div",{className:Object(o.css)({width:u,height:p,overflow:"hidden",position:"relative",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontSize:"2rem"},"Metric"===a.colorMode&&O[P])},c.a.createElement(g,{href:a.clusterUrl,target:a.clusterTargetBlank?"_blank":"_self",title:a.clusterName},"crit"===P?"Critical":"disable"===P?"Disabled":"noData"===P?"No Data":"ok"===P?"OK":"Warn")),c.a.createElement("div",{className:Object(o.css)({height:p,display:"flex",flexDirection:"column"})},c.a.createElement("div",{className:Object(o.css)({flex:"1 0 0",display:"flex",flexDirection:"column",justifyContent:"center"})},c.a.createElement("div",{className:Object(o.css)({minHeight:"1px",display:"flex",justifyContent:"center",fontSize:"1.5rem"})},c.a.createElement(g,{href:a.clusterUrl,target:a.clusterTargetBlank?"_blank":"_self",title:a.clusterName},v(a.clusterName)))),c.a.createElement("div",{className:Object(o.css)({display:"flex",flexDirection:"column",alignItems:"center",overflow:"scroll",flex:"0 1 auto","::-webkit-scrollbar":{background:"transparent",width:"0px",display:"none"}})},c.a.createElement(m,{hover:A,autoScroll:a.isAutoScrollOnOverflow},c.a.createElement("div",null,D.map((function(e){var t,a,r=e.alias,l=e.link,n=e.className,i=e.displayValue;return c.a.createElement("div",{className:n,style:{color:"inherit"}},c.a.createElement(g,{href:null===(t=l)||void 0===t?void 0:t.href,target:null===(a=l)||void 0===a?void 0:a.target,title:r,style:{color:"inherit"}},i?r+" - "+i:r))})),j&&c.a.createElement("span",{className:Object(o.css)({paddingTop:"2px",fontSize:"0.85rem"})},"+ ",j," more")))),c.a.createElement("div",{className:Object(o.css)({fontSize:"1.5rem",minHeight:"1px",flex:"1 1 0"})}),c.a.createElement("div",{className:Object(o.css)({position:"absolute",height:p,overflow:"scroll",padding:"1rem",display:"flex",flexDirection:"column","::-webkit-scrollbar":{background:"transparent",width:"0px",display:"none"}})},c.a.createElement(m,{hover:A,autoScroll:a.isAutoScrollOnOverflow},c.a.createElement("div",{className:Object(o.css)({fontSize:"0.85rem"})},x.map((function(e){var t,a,r=e.alias,l=e.link,n=e.className,i=e.displayValue;return c.a.createElement("div",{className:n,style:{color:"inherit"}},c.a.createElement(g,{href:null===(t=l)||void 0===t?void 0:t.href,target:null===(a=l)||void 0===a?void 0:a.target,title:r,style:{color:"inherit"}},i?r+" - "+i:r))}))))))),A&&c.a.createElement(i.IconButton,{name:"exchange-alt",onClick:function(){return I(!k)},className:Object(o.css)({position:"absolute",bottom:"2rem",right:"2rem"})}))})).setMigrationHandler((function(e){var t,a;if(function(e){return!!e.options&&"clusterName"in e}(e)){var r=e.links[0];return{clusterName:e.clusterName,clusterUrl:null===(t=r)||void 0===t?void 0:t.url,clusterTargetBlank:!!(null===(a=r)||void 0===a?void 0:a.targetBlank),namePrefix:e.namePrefix,maxAlertNumber:e.maxAlertNumber,cornerRadius:e.cornerRadius+"%",flipCard:e.flipCard,flipTime:e.flipTime,colorMode:e.colorMode,colors:e.colors,isAutoScrollOnOverflow:e.isAutoScrollOnOverflow,isGrayOnNoData:e.isGrayOnNoData,isIgnoreOKColors:e.isIgnoreOKColors,isHideAlertsOnDisable:e.isHideAlertsOnDisable}}return{}})).setPanelOptions((function(e){return e.addTextInput({path:"clusterName",name:"Cluster Name",description:"",defaultValue:"",category:["Panel Options"],settings:{expandTemplateVars:!0}}).addTextInput({path:"clusterUrl",name:"Cluster URL",description:"",defaultValue:"",category:["Panel Options"],settings:{expandTemplateVars:!0}}).addBooleanSwitch({path:"clusterTargetBlank",name:"Open Cluster URL in new tab",defaultValue:!1,category:["Panel Options"],showIf:function(e){return!!e.clusterUrl}}).addTextInput({path:"namePrefix",name:"Remove Prefix",defaultValue:"",description:"A prefix to remove from the name (helpful when repeating panel over a template)",category:["Panel Options"]}).addNumberInput({path:"maxAlertNumber",name:"Max Alerts",defaultValue:-1,description:"Max alerts number to show in the panel. In case value is less than zero, show all alerts",category:["Panel Options"]}).addTextInput({path:"cornerRadius",name:"Corner Radius",defaultValue:"0rem",description:"The corner radius to apply the panel. Values are used for the border-radius CSS attribute.",category:["Panel Options"]}).addBooleanSwitch({path:"flipCard",name:"Flip Panel",defaultValue:!1,category:["Panel Options"]}).addNumberInput({path:"flipTime",name:"Flip interval",defaultValue:5,category:["Panel Options"],showIf:function(e){return e.flipCard}}).addSelect({path:"colorMode",name:"Coloring Mode",description:"",defaultValue:"Panel",settings:{options:[{label:"Panel",value:"Panel",description:"Apply color to the panel background"},{label:"Metric",value:"Metric",description:"Apply color to the metric text"},{label:"Disabled",value:"Disabled",description:"Do not apply any coloring"}]},category:["Threshold Options"]}).addCustomEditor({id:"colors",path:"colors",name:"Colors",editor:y,category:["Threshold Options"]}).addBooleanSwitch({path:"isAutoScrollOnOverflow",name:"Auto scroll alerts on overflow",defaultValue:!1,category:["Other Options"]}).addBooleanSwitch({path:"isGrayOnNoData",name:"Use 'Disable' color if no data",defaultValue:!1,category:["Other Options"]}).addBooleanSwitch({path:"isIgnoreOKColors",name:"Ignore color in OK state",defaultValue:!1,category:["Other Options"]}).addBooleanSwitch({path:"isHideAlertsOnDisable",name:"Hide alerts in Disabled state",defaultValue:!1,category:["Other Options"]})})).useFieldConfig({useCustomConfig:function(e){return e.addSelect({path:"aggregation",name:"Aggregation",description:"What to do if the query returns multiple data points.",defaultValue:"last",settings:{options:[{label:"Last",value:"last"},{label:"First",value:"first"},{label:"Max",value:"max"},{label:"Min",value:"min"},{label:"Sum",value:"sum"},{label:"Avg",value:"mean"},{label:"Delta",value:"delta"}]},category:["Display Options"]}).addTextInput({path:"valueDisplayRegex",name:"Value Regex",description:"A regex which will decide the part of the value to be displayed. In case the regex is empty or it doesn't match any part of the metrics value, all the metric value will be displayed.",defaultValue:"",settings:{},category:["Display Options"]}).addSelect({path:"fontFormat",name:"Font Format",description:"The metric text font format in disable, warning or critical state",defaultValue:"Regular",settings:{options:[{label:"Regular",value:"Regular"},{label:"Bold",value:"Bold"},{label:"Italic",value:"Italic"}]},category:["Display Options"]}).addCustomEditor({path:"thresholds",id:"thresholds",name:"Threshold Type",defaultValue:{valueHandler:"Number Threshold",warn:70,crit:90},description:"The type of data to show to the panel.",editor:w,override:w,category:["Threshold Options"],process:function(e){return e},shouldApply:function(){return!0}}).addSelect({path:"displayType",name:"Display Position",description:"The location the value will be displayed",defaultValue:"Regular",settings:{options:[{label:"Regular",value:"Regular",description:"The alias + the value will be display in the center, under the panel title"},{label:"Annotation",value:"Annotation",description:"The alias + the value will be displayed on top left. If the value answers a threshold condition, it will displayed as regular state"}]},category:["Display Options"],showIf:function(e){return"Disable Criteria"!==e.thresholds.valueHandler}}).addTextInput({path:"dateFormat",name:"Date Format",defaultValue:"YYYY-MM-DD HH:mm:ss",description:'Specify the Date/Time format (Use "lll" for local date/time format)',category:["Display Options"],showIf:function(e){return"Date Threshold"===e.thresholds.valueHandler}}).addSelect({path:"displayAliasType",name:"Display Alias",description:"When to display the alias",defaultValue:"Warning / Critical",settings:{options:[{label:"Warning / Critical",value:"Warning / Critical",description:"The alias will be displayed in warning or critical state"},{label:"Always",value:"Always",description:"The alias will always be displayed, regardless critical and warning state"}]},category:["Display Options"],showIf:function(e){return"Threshold"===e.thresholds.valueHandler.slice(-9)}}).addSelect({path:"displayValueWithAlias",name:"Display Value",description:"When to display the value along with the alias",defaultValue:"When Alias Displayed",settings:{options:[{label:"Never",value:"Never",description:"The value will never be displayed"},{label:"When Alias Displayed",value:"When Alias Displayed",description:"The value will be displayed always when alias is displayed"},{label:"Warning / Critical",value:"Warning / Critical",description:"The value will be displayed in warning or critical state"},{label:"Critical Only",value:"Critical Only",description:"The value will be displayed in critical only"}]},category:["Display Options"],showIf:function(e){return"Threshold"===e.thresholds.valueHandler.slice(-9)}}).addTextInput({path:"disabledValue",name:"Disable Criteria",description:"The exact value which will make this panel to be displayed as disabled",category:["Threshold Options"],showIf:function(e){return"Disable Criteria"===e.thresholds.valueHandler}})}})}])}));
//# sourceMappingURL=module.js.map